version: '3.8'

services:
  web:
    image: rjchicago/rjchicago-llc-web:${VERSION:-latest}
    build:
      context: ./web
      target: ${TARGET:-development}
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_CONTACT_ENDPOINT=http://localhost:4000/contact
    volumes:
      - ./web/src:/web/src
    restart: unless-stopped
    container_name: rjchicago-llc-web

  api:
    image: rjchicago/rjchicago-llc-api:${VERSION:-latest}
    build:
      context: ./api
      target: ${TARGET:-development}
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - CORS_ORIGIN=http://localhost:3000
    volumes:
      - ./api/src:/api/src
      - ./api/package.json:/api/package.json
    env_file:
      - ./api/.env
    restart: unless-stopped
    container_name: rjchicago-llc-api
